version: "3.8"

services:

  pagy-rails:
    image: pagy-rails:latest
    build:
      context: .
      dockerfile: pagy-rails.dockerfile
      # set env variables with your user info
      args:
        user: koshy
        group: $GROUP
        uid: 1000
        gid: 1000
        password: "${PASSWORD:-rubydev}"
        term: ${TERM:-xterm-256color}
    container_name: pagy-rails-app
    user: $USER
#    environment:
#      - WEBPACKER_DEV_SERVER_HOST=0.0.0.0
#      - WEBPACKER_DEV_SERVER_PORT=3035
#      - WEBPACKER_DEV_SERVER_PUBLIC=0.0.0.0:3035
    volumes:
      - ../.:/opt/project
      - bundle:/usr/local/bundle
      - user_home:/home/$USER

    ports:
#      - "1234:1234"   # RubyMine debugger
      - "3035:3035"
      - "3000:3000"
    command: /opt/project/pagy-rails-docker/start.sh

    stdin_open: true
    tty: true

  elastic:
    image: elasticsearch:7.13.2
    container_name: pagy-rails-elastic
    environment:
      - discovery.type=single-node
      - http.port=9200
      - http.cors.allow-origin=chrome-extension://jopjeaiilkcibeohjdmejhoifenbnmlh,https://opensource.appbase.io
      - http.cors.enabled=true
      - http.cors.allow-headers=X-Requested-With,X-Auth-Token,Content-Type,Content-Length,Authorization
      - http.cors.allow-credentials=true
      - "ES_JAVA_OPTS=-Xms512m -Xmx512m"
    ports:
      - "9200:9200"
    volumes:
      - elastic_data:/usr/share/elasticsearch/data

volumes:
  bundle:
    name: pagy_rails_bundle
  user_home:
    name: pagy_rails_user_home
  elastic_data:
    name: pagy_rails_elastic_data

networks:
  default:
    ipam:
      driver: default
      config:
        - subnet: 172.33.0.0/16
